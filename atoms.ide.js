/* atoms v0.3.01 - 2014/2/14
   http://atomic.tapquo.com
   Copyright (c) 2014 Tapquo S.L. - Licensed  */
(function(){var _ref,_ref1,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Atoms.Ide={Atom:{},Molecule:{},Organism:{},Constants:{}},Atoms.Ide.Constants={ICONS:[{label:"- none -",value:""},{label:"arrow-left",value:"arrow-left"},{label:"arrow-right",value:"arrow-right"},{label:"arrow-up",value:"arrow-up"},{label:"arrow-down-a",value:"arrow-down-a"},{label:"arrow-down-b",value:"arrow-down-b"},{label:"arrow-down-c",value:"arrow-down-c"},{label:"arrow-expand",value:"arrow-expand"},{label:"arrow-graph-down-left",value:"arrow-graph-down-left"},{label:"arrow-graph-down-right",value:"arrow-graph-down-right"},{label:"arrow-graph-up-left",value:"arrow-graph-up-left"},{label:"arrow-graph-up-right",value:"arrow-graph-up-right"},{label:"arrow-left-a",value:"arrow-left-a"},{label:"arrow-left-b",value:"arrow-left-b"},{label:"arrow-left-c",value:"arrow-left-c"},{label:"arrow-move",value:"arrow-move"},{label:"arrow-resize",value:"arrow-resize"},{label:"arrow-return-left",value:"arrow-return-left"},{label:"arrow-return-right",value:"arrow-return-right"},{label:"arrow-right-a",value:"arrow-right-a"},{label:"arrow-right-b",value:"arrow-right-b"},{label:"arrow-right-c",value:"arrow-right-c"},{label:"arrow-shrink",value:"arrow-shrink"},{label:"arrow-swap",value:"arrow-swap"},{label:"arrow-up-a",value:"arrow-up-a"},{label:"arrow-up-b",value:"arrow-up-b"},{label:"arrow-up-c",value:"arrow-up-c"},{label:"arrow-down-d",value:"arrow-down-d"},{label:"arrow-left-d",value:"arrow-left-d"},{label:"arrow-right-d",value:"arrow-right-d"},{label:"arrow-up-d",value:"arrow-up-d"},{label:"archive",value:"archive"},{label:"at",value:"at"},{label:"battery-charging",value:"battery-charging"},{label:"battery-empty",value:"battery-empty"},{label:"battery-full",value:"battery-full"},{label:"battery-half",value:"battery-half"},{label:"battery-low",value:"battery-low"},{label:"bluetooth",value:"bluetooth"},{label:"bookmark",value:"bookmark"},{label:"briefcase",value:"briefcase"},{label:"calendar",value:"calendar"},{label:"chatbox",value:"chatbox"},{label:"chatbox-working",value:"chatbox-working"},{label:"chatboxes",value:"chatboxes"},{label:"chatbubble",value:"chatbubble"},{label:"chatbubble-working",value:"chatbubble-working"},{label:"chatbubbles",value:"chatbubbles"},{label:"clipboard",value:"clipboard"},{label:"clock",value:"clock"},{label:"close",value:"close"},{label:"close-circled",value:"close-circled"},{label:"close-round",value:"close-round"},{label:"cloud",value:"cloud"},{label:"code",value:"code"},{label:"code-download",value:"code-download"},{label:"code-working",value:"code-working"},{label:"compass",value:"compass"},{label:"compose",value:"compose"},{label:"connection-bars",value:"connection-bars"},{label:"contrast",value:"contrast"},{label:"disc",value:"disc"},{label:"document",value:"document"},{label:"document-text",value:"document-text"},{label:"drag",value:"drag"},{label:"earth",value:"earth"},{label:"email",value:"email"},{label:"eye",value:"eye"},{label:"filing",value:"filing"},{label:"film-marker",value:"film-marker"},{label:"flag",value:"flag"},{label:"flash",value:"flash"},{label:"flash-off",value:"flash-off"},{label:"folder",value:"folder"},{label:"gear-a",value:"gear-a"},{label:"gear-b",value:"gear-b"},{label:"grid",value:"grid"},{label:"headphone",value:"headphone"},{label:"heart",value:"heart"},{label:"home",value:"home"},{label:"icecream",value:"icecream"},{label:"image",value:"image"},{label:"images",value:"images"},{label:"ionic",value:"ionic"},{label:"ios7-alarm",value:"ios7-alarm"},{label:"ios7-alarm-outline",value:"ios7-alarm-outline"},{label:"ios7-albums",value:"ios7-albums"},{label:"ios7-albums-outline",value:"ios7-albums-outline"},{label:"ios7-at",value:"ios7-at"},{label:"ios7-at-outline",value:"ios7-at-outline"},{label:"ios7-bell",value:"ios7-bell"},{label:"ios7-bell-outline",value:"ios7-bell-outline"},{label:"ios7-bolt",value:"ios7-bolt"},{label:"ios7-bolt-outline",value:"ios7-bolt-outline"},{label:"ios7-bookmarks",value:"ios7-bookmarks"},{label:"ios7-bookmarks-outline",value:"ios7-bookmarks-outline"},{label:"ios7-box",value:"ios7-box"},{label:"ios7-box-outline",value:"ios7-box-outline"},{label:"ios7-briefcase",value:"ios7-briefcase"},{label:"ios7-briefcase-outline",value:"ios7-briefcase-outline"},{label:"ios7-browsers",value:"ios7-browsers"},{label:"ios7-browsers-outline",value:"ios7-browsers-outline"},{label:"ios7-calendar",value:"ios7-calendar"},{label:"ios7-calendar-outline",value:"ios7-calendar-outline"},{label:"ios7-cart",value:"ios7-cart"},{label:"ios7-cart-outline",value:"ios7-cart-outline"},{label:"ios7-chatboxes",value:"ios7-chatboxes"},{label:"ios7-chatboxes-outline",value:"ios7-chatboxes-outline"},{label:"ios7-chatbubble",value:"ios7-chatbubble"},{label:"ios7-chatbubble-outline",value:"ios7-chatbubble-outline"},{label:"ios7-circle-filled",value:"ios7-circle-filled"},{label:"ios7-circle-outline",value:"ios7-circle-outline"},{label:"ios7-clock",value:"ios7-clock"},{label:"ios7-clock-outline",value:"ios7-clock-outline"},{label:"ios7-close",value:"ios7-close"},{label:"ios7-close-outline",value:"ios7-close-outline"},{label:"ios7-cloud",value:"ios7-cloud"},{label:"ios7-cloud-download",value:"ios7-cloud-download"},{label:"ios7-cloud-download-outline",value:"ios7-cloud-download-outline"},{label:"ios7-cloud-outline",value:"ios7-cloud-outline"},{label:"ios7-cloud-upload",value:"ios7-cloud-upload"},{label:"ios7-cloud-upload-outline",value:"ios7-cloud-upload-outline"},{label:"ios7-cloudy",value:"ios7-cloudy"},{label:"ios7-cloudy-outline",value:"ios7-cloudy-outline"},{label:"ios7-cog",value:"ios7-cog"},{label:"ios7-cog-outline",value:"ios7-cog-outline"},{label:"ios7-compose",value:"ios7-compose"},{label:"ios7-compose-outline",value:"ios7-compose-outline"},{label:"ios7-copy",value:"ios7-copy"},{label:"ios7-copy-outline",value:"ios7-copy-outline"},{label:"ios7-download",value:"ios7-download"},{label:"ios7-download-outline",value:"ios7-download-outline"},{label:"ios7-drag",value:"ios7-drag"},{label:"ios7-email",value:"ios7-email"},{label:"ios7-email-outline",value:"ios7-email-outline"},{label:"ios7-eye",value:"ios7-eye"},{label:"ios7-eye-outline",value:"ios7-eye-outline"},{label:"ios7-filing",value:"ios7-filing"},{label:"ios7-filing-outline",value:"ios7-filing-outline"},{label:"ios7-film",value:"ios7-film"},{label:"ios7-film-outline",value:"ios7-film-outline"},{label:"ios7-flag",value:"ios7-flag"},{label:"ios7-flag-outline",value:"ios7-flag-outline"},{label:"ios7-folder",value:"ios7-folder"},{label:"ios7-folder-outline",value:"ios7-folder-outline"},{label:"ios7-gear",value:"ios7-gear"},{label:"ios7-gear-outline",value:"ios7-gear-outline"},{label:"ios7-glasses",value:"ios7-glasses"},{label:"ios7-glasses-outline",value:"ios7-glasses-outline"},{label:"ios7-heart",value:"ios7-heart"},{label:"ios7-heart-outline",value:"ios7-heart-outline"},{label:"ios7-infinite",value:"ios7-infinite"},{label:"ios7-infinite-outline",value:"ios7-infinite-outline"},{label:"ios7-keypad",value:"ios7-keypad"},{label:"ios7-keypad-outline",value:"ios7-keypad-outline"},{label:"ios7-lightbulb",value:"ios7-lightbulb"},{label:"ios7-lightbulb-outline",value:"ios7-lightbulb-outline"},{label:"ios7-location",value:"ios7-location"},{label:"ios7-location-outline",value:"ios7-location-outline"},{label:"ios7-locked",value:"ios7-locked"},{label:"ios7-locked-outline",value:"ios7-locked-outline"},{label:"ios7-mic",value:"ios7-mic"},{label:"ios7-mic-off",value:"ios7-mic-off"},{label:"ios7-mic-outline",value:"ios7-mic-outline"},{label:"ios7-moon",value:"ios7-moon"},{label:"ios7-moon-outline",value:"ios7-moon-outline"},{label:"ios7-more",value:"ios7-more"},{label:"ios7-more-outline",value:"ios7-more-outline"},{label:"ios7-musical-note",value:"ios7-musical-note"},{label:"ios7-musical-notes",value:"ios7-musical-notes"},{label:"ios7-navigate",value:"ios7-navigate"},{label:"ios7-navigate-outline",value:"ios7-navigate-outline"},{label:"ios7-paperplane",value:"ios7-paperplane"},{label:"ios7-paperplane-outline",value:"ios7-paperplane-outline"},{label:"ios7-partlysunny",value:"ios7-partlysunny"},{label:"ios7-partlysunny-outline",value:"ios7-partlysunny-outline"},{label:"ios7-photos",value:"ios7-photos"},{label:"ios7-photos-outline",value:"ios7-photos-outline"},{label:"ios7-pie",value:"ios7-pie"},{label:"ios7-pie-outline",value:"ios7-pie-outline"},{label:"ios7-pricetag",value:"ios7-pricetag"},{label:"ios7-pricetag-outline",value:"ios7-pricetag-outline"},{label:"ios7-rainy",value:"ios7-rainy"},{label:"ios7-rainy-outline",value:"ios7-rainy-outline"},{label:"ios7-recording",value:"ios7-recording"},{label:"ios7-recording-outline",value:"ios7-recording-outline"},{label:"ios7-redo",value:"ios7-redo"},{label:"ios7-redo-outline",value:"ios7-redo-outline"},{label:"ios7-refresh",value:"ios7-refresh"},{label:"ios7-refresh-empty",value:"ios7-refresh-empty"},{label:"ios7-refresh-outline",value:"ios7-refresh-outline"},{label:"ios7-reload:before,ios7-reloading",value:"ios7-reload:before,ios7-reloading"},{label:"ios7-search",value:"ios7-search"},{label:"ios7-search-strong",value:"ios7-search-strong"},{label:"ios7-speedometer",value:"ios7-speedometer"},{label:"ios7-speedometer-outline",value:"ios7-speedometer-outline"},{label:"ios7-star",value:"ios7-star"},{label:"ios7-star-outline",value:"ios7-star-outline"},{label:"ios7-stopwatch",value:"ios7-stopwatch"},{label:"ios7-stopwatch-outline",value:"ios7-stopwatch-outline"},{label:"ios7-sunny",value:"ios7-sunny"},{label:"ios7-sunny-outline",value:"ios7-sunny-outline"},{label:"ios7-telephone",value:"ios7-telephone"},{label:"ios7-telephone-outline",value:"ios7-telephone-outline"},{label:"ios7-thunderstorm",value:"ios7-thunderstorm"},{label:"ios7-thunderstorm-outline",value:"ios7-thunderstorm-outline"},{label:"ios7-time",value:"ios7-time"},{label:"ios7-time-outline",value:"ios7-time-outline"},{label:"ios7-timer",value:"ios7-timer"},{label:"ios7-timer-outline",value:"ios7-timer-outline"},{label:"ios7-trash",value:"ios7-trash"},{label:"ios7-trash-outline",value:"ios7-trash-outline"},{label:"ios7-undo",value:"ios7-undo"},{label:"ios7-undo-outline",value:"ios7-undo-outline"},{label:"ios7-unlocked",value:"ios7-unlocked"},{label:"ios7-unlocked-outline",value:"ios7-unlocked-outline"},{label:"ios7-upload",value:"ios7-upload"},{label:"ios7-upload-outline",value:"ios7-upload-outline"},{label:"ios7-world",value:"ios7-world"},{label:"ios7-world-outline",value:"ios7-world-outline"},{label:"key",value:"key"},{label:"levels",value:"levels"},{label:"lightbulb",value:"lightbulb"},{label:"link",value:"link"},{label:"location",value:"location"},{label:"locked",value:"locked"},{label:"log-in",value:"log-in"},{label:"log-out",value:"log-out"},{label:"loop:before,looping",value:"loop:before,looping"},{label:"map",value:"map"},{label:"mic-a",value:"mic-a"},{label:"mic-b",value:"mic-b"},{label:"mic-c",value:"mic-c"},{label:"more",value:"more"},{label:"music-note",value:"music-note"},{label:"navicon",value:"navicon"},{label:"navicon-round",value:"navicon-round"},{label:"navigate",value:"navigate"},{label:"nuclear",value:"nuclear"},{label:"paperclip",value:"paperclip"},{label:"pie-graph",value:"pie-graph"},{label:"pin",value:"pin"},{label:"pinpoint",value:"pinpoint"},{label:"pound",value:"pound"},{label:"power",value:"power"},{label:"pricetag",value:"pricetag"},{label:"pricetags",value:"pricetags"},{label:"radio-waves",value:"radio-waves"},{label:"record",value:"record"},{label:"refresh:before,refreshing",value:"refresh:before,refreshing"},{label:"reply",value:"reply"},{label:"reply-all",value:"reply-all"},{label:"search",value:"search"},{label:"settings",value:"settings"},{label:"share",value:"share"},{label:"speakerphone",value:"speakerphone"},{label:"speedometer",value:"speedometer"},{label:"star",value:"star"},{label:"stats-bars",value:"stats-bars"},{label:"stop",value:"stop"},{label:"thumbsdown",value:"thumbsdown"},{label:"thumbsup",value:"thumbsup"},{label:"trash-a",value:"trash-a"},{label:"trash-b",value:"trash-b"},{label:"umbrella",value:"umbrella"},{label:"unlocked",value:"unlocked"},{label:"upload",value:"upload"},{label:"usb",value:"usb"},{label:"waterdrop",value:"waterdrop"},{label:"wifi",value:"wifi"},{label:"wrench",value:"wrench"},{label:"tv",value:"tv"},{label:"tv-outline",value:"tv-outline"},{label:"monitor",value:"monitor"},{label:"laptop",value:"laptop"},{label:"ipad",value:"ipad"},{label:"iphone",value:"iphone"},{label:"ipod",value:"ipod"},{label:"game-controller-a",value:"game-controller-a"},{label:"game-controller-b",value:"game-controller-b"},{label:"calculator",value:"calculator"},{label:"ios7-calculator",value:"ios7-calculator"},{label:"ios7-calculator-outline",value:"ios7-calculator-outline"},{label:"ios7-printer",value:"ios7-printer"},{label:"ios7-printer-outline",value:"ios7-printer-outline"},{label:"printer",value:"printer"},{label:"ios7-camera",value:"ios7-camera"},{label:"ios7-camera-outline",value:"ios7-camera-outline"},{label:"videocamera",value:"videocamera"},{label:"camera",value:"camera"},{label:"ios7-videocam",value:"ios7-videocam"},{label:"ios7-videocam-outline",value:"ios7-videocam-outline"},{label:"loading-a",value:"loading-a"},{label:"loading-b",value:"loading-b"},{label:"loading-c",value:"loading-c"},{label:"loading-d",value:"loading-d"},{label:"loading-e",value:"loading-e"},{label:"back",value:"back"},{label:"down",value:"down"},{label:"forward",value:"forward"},{label:"left",value:"left"},{label:"right",value:"right"},{label:"up",value:"up"},{label:"beaker",value:"beaker"},{label:"beer",value:"beer"},{label:"leaf",value:"leaf"},{label:"wineglass",value:"wineglass"},{label:"ios7-wineglass",value:"ios7-wineglass"},{label:"ios7-wineglass-outline",value:"ios7-wineglass-outline"},{label:"knife",value:"knife"},{label:"fork",value:"fork"},{label:"spoon",value:"spoon"},{label:"hammer",value:"hammer"},{label:"pizza",value:"pizza"},{label:"plane",value:"plane"},{label:"jet",value:"jet"},{label:"thermometer",value:"thermometer"},{label:"card",value:"card"},{label:"bag",value:"bag"},{label:"egg",value:"egg"},{label:"ios7-medkit",value:"ios7-medkit"},{label:"ios7-medkit-outline",value:"ios7-medkit-outline"},{label:"medkit",value:"medkit"},{label:"magnet",value:"magnet"},{label:"flask",value:"flask"},{label:"coffee",value:"coffee"},{label:"people",value:"people"},{label:"people-outline",value:"people-outline"},{label:"person",value:"person"},{label:"person-outline",value:"person-outline"},{label:"personadd",value:"personadd"},{label:"personadd-outline",value:"personadd-outline"},{label:"contact",value:"contact"},{label:"contact-outline",value:"contact-outline"},{label:"man",value:"man"},{label:"woman",value:"woman"},{label:"person-b",value:"person-b"},{label:"person-b-add",value:"person-b-add"},{label:"people-b",value:"people-b"},{label:"female",value:"female"},{label:"male",value:"male"},{label:"play",value:"play"},{label:"ios7-play",value:"ios7-play"},{label:"ios7-play-outline",value:"ios7-play-outline"},{label:"pause",value:"pause"},{label:"ios7-pause",value:"ios7-pause"},{label:"ios7-pause-outline",value:"ios7-pause-outline"},{label:"ios7-skipbackward",value:"ios7-skipbackward"},{label:"ios7-skipbackward-outline",value:"ios7-skipbackward-outline"},{label:"ios7-skipforward",value:"ios7-skipforward"},{label:"ios7-skipforward-outline",value:"ios7-skipforward-outline"},{label:"skip-backward",value:"skip-backward"},{label:"skip-forward",value:"skip-forward"},{label:"ios7-rewind",value:"ios7-rewind"},{label:"ios7-rewind-outline",value:"ios7-rewind-outline"},{label:"ios7-fastforward",value:"ios7-fastforward"},{label:"ios7-fastforward-outline",value:"ios7-fastforward-outline"},{label:"ios7-volume-high",value:"ios7-volume-high"},{label:"ios7-volume-low",value:"ios7-volume-low"},{label:"volume-high",value:"volume-high"},{label:"volume-low",value:"volume-low"},{label:"volume-medium",value:"volume-medium"},{label:"volume-mute",value:"volume-mute"},{label:"eject",value:"eject"},{label:"shuffle",value:"shuffle"},{label:"alert",value:"alert"},{label:"alert-circled",value:"alert-circled"},{label:"information",value:"information"},{label:"information-circled",value:"information-circled"},{label:"ios7-information",value:"ios7-information"},{label:"ios7-information-empty",value:"ios7-information-empty"},{label:"ios7-information-outline",value:"ios7-information-outline"},{label:"ios7-help",value:"ios7-help"},{label:"ios7-help-empty",value:"ios7-help-empty"},{label:"ios7-help-outline",value:"ios7-help-outline"},{label:"checkmark",value:"checkmark"},{label:"checkmark-circled",value:"checkmark-circled"},{label:"checkmark-round",value:"checkmark-round"},{label:"ios7-plus",value:"ios7-plus"},{label:"ios7-plus-empty",value:"ios7-plus-empty"},{label:"ios7-plus-outline",value:"ios7-plus-outline"},{label:"plus",value:"plus"},{label:"plus-circled",value:"plus-circled"},{label:"plus-round",value:"plus-round"},{label:"ios7-minus",value:"ios7-minus"},{label:"ios7-minus-empty",value:"ios7-minus-empty"},{label:"ios7-minus-outline",value:"ios7-minus-outline"},{label:"minus",value:"minus"},{label:"minus-circled",value:"minus-circled"},{label:"minus-round",value:"minus-round"},{label:"ios7-checkmark",value:"ios7-checkmark"},{label:"ios7-checkmark-empty",value:"ios7-checkmark-empty"},{label:"ios7-checkmark-outline",value:"ios7-checkmark-outline"},{label:"help",value:"help"},{label:"help-buoy",value:"help-buoy"},{label:"help-circled",value:"help-circled"},{label:"icon-social-google-plus",value:"icon-social-google-plus"},{label:"icon-social-google-plus-outline",value:"icon-social-google-plus-outline"},{label:"social-android",value:"social-android"},{label:"social-android-outline",value:"social-android-outline"},{label:"social-apple",value:"social-apple"},{label:"social-apple-outline",value:"social-apple-outline"},{label:"social-bitcoin",value:"social-bitcoin"},{label:"social-bitcoin-outline",value:"social-bitcoin-outline"},{label:"social-buffer",value:"social-buffer"},{label:"social-buffer-outline",value:"social-buffer-outline"},{label:"social-designernews",value:"social-designernews"},{label:"social-designernews-outline",value:"social-designernews-outline"},{label:"social-dribbble",value:"social-dribbble"},{label:"social-dribbble-outline",value:"social-dribbble-outline"},{label:"social-dropbox",value:"social-dropbox"},{label:"social-dropbox-outline",value:"social-dropbox-outline"},{label:"social-facebook",value:"social-facebook"},{label:"social-facebook-outline",value:"social-facebook-outline"},{label:"social-github",value:"social-github"},{label:"social-github-outline",value:"social-github-outline"},{label:"social-googleplus",value:"social-googleplus"},{label:"social-googleplus-outline",value:"social-googleplus-outline"},{label:"social-hackernews",value:"social-hackernews"},{label:"social-hackernews-outline",value:"social-hackernews-outline"},{label:"social-linkedin",value:"social-linkedin"},{label:"social-linkedin-outline",value:"social-linkedin-outline"},{label:"social-pinterest",value:"social-pinterest"},{label:"social-pinterest-outline",value:"social-pinterest-outline"},{label:"social-reddit",value:"social-reddit"},{label:"social-reddit-outline",value:"social-reddit-outline"},{label:"social-rss",value:"social-rss"},{label:"social-rss-outline",value:"social-rss-outline"},{label:"social-skype",value:"social-skype"},{label:"social-skype-outline",value:"social-skype-outline"},{label:"social-tumblr",value:"social-tumblr"},{label:"social-tumblr-outline",value:"social-tumblr-outline"},{label:"social-twitter",value:"social-twitter"},{label:"social-twitter-outline",value:"social-twitter-outline"},{label:"social-vimeo",value:"social-vimeo"},{label:"social-vimeo-outline",value:"social-vimeo-outline"},{label:"social-windows",value:"social-windows"},{label:"social-windows-outline",value:"social-windows-outline"},{label:"social-wordpress",value:"social-wordpress"},{label:"social-wordpress-outline",value:"social-wordpress-outline"},{label:"social-yahoo",value:"social-yahoo"},{label:"social-yahoo-outline",value:"social-yahoo-outline"},{label:"social-youtube",value:"social-youtube"},{label:"social-youtube-outline",value:"social-youtube-outline"}]},Atoms.Ide.Project=function(){var PROJECT_STORAGE_KEY,getChilds,getStructure,load,loadStructure,save,searchNode,updateNode,_components,_getRoots,_parse,_structure;return PROJECT_STORAGE_KEY="atoms-ide-project",_components=null,_structure=null,load=function(){var component,first_component,key,_i,_len,_ref,_results;if(_structure=JSON.parse(localStorage.getItem(PROJECT_STORAGE_KEY,[]))){for(Ide.Article.components={},first_component=null,_i=0,_len=_structure.length;_len>_i;_i++)component=_structure[_i],loadStructure(Ide.Article.canvas,component);Ide.Elements.updateTree(),_ref=Ide.Article.components,_results=[];for(key in _ref){if(component=_ref[key],"Article"===component.constructor.name){Ide.Properties.load(component);break}_results.push(void 0)}return _results}},save=function(toStorage){return null==toStorage&&(toStorage=!0),_structure=getStructure(toStorage?!1:!0),toStorage?localStorage.setItem(PROJECT_STORAGE_KEY,JSON.stringify(_structure)):void 0},searchNode=function(uid,struct){var child,data,node,ns,_i,_len;for(struct=struct||_structure,_i=0,_len=struct.length;_len>_i;_i++){child=struct[_i];for(ns in child){if(data=child[ns],data.uid===uid)return child;if(node=searchNode(uid,data.children))return node}}},getStructure=function(addUID){var root,root_tree,structure,_i,_len,_ref;for(null==addUID&&(addUID=!1),_components=Ide.Article.components,structure=[],_ref=_getRoots(),_i=0,_len=_ref.length;_len>_i;_i++)root=_ref[_i],root_tree={},root_tree[""+root.constructor.type+"."+root.constructor.name]=getChilds(root,addUID),structure.push(root_tree);return structure},getChilds=function(component,addUID){var comp,obj,parsed_component,uid;null==addUID&&(addUID=!1),parsed_component=_parse(component,addUID);for(uid in _components)comp=_components[uid],comp.parent.uid===component.uid&&(obj={},obj[""+comp.constructor.type+"."+comp.constructor.name]=getChilds(comp,addUID),parsed_component.children.push(obj));return parsed_component},loadStructure=function(parent,component,isUpdate){var attributes,child,children,createdComponent,namespace,_results;null==isUpdate&&(isUpdate=!1),_results=[];for(namespace in component)attributes=component[namespace],isUpdate&&delete Ide.Article.components[attributes.uid],attributes.parent=parent,children=attributes.children,delete attributes.children,createdComponent=Ide.Article.appendComponent(namespace,attributes,!1),_results.push(function(){var _i,_len,_results1;for(_results1=[],_i=0,_len=children.length;_len>_i;_i++)child=children[_i],_results1.push(loadStructure(createdComponent,child,isUpdate));return _results1}());return _results},updateNode=function(uid){var child,data,node,ns,structure,_results;structure=getStructure(!0),node=searchNode(uid,structure),_results=[];for(ns in node)data=node[ns],_results.push(function(){var _i,_len,_ref,_results1;for(_ref=data.children,_results1=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results1.push(loadStructure(Ide.Article.components[uid],child,!0));return _results1}());return _results},_getRoots=function(){var component,uid,_ref,_results;_results=[];for(uid in _components)component=_components[uid],("Article"===(_ref=component.constructor.name)||"Aside"===_ref)&&_results.push(component);return _results},_parse=function(component,addUID){var attribute,parsed,value,_ref;null==addUID&&(addUID=!1),parsed={children:[]},_ref=component.attributes;for(attribute in _ref)value=_ref[attribute],"if"!==attribute&&(parsed[attribute]=value);return addUID&&(parsed.uid=component.uid),parsed},$$(load),{save:save,load:load,getStructure:getStructure,updateNode:updateNode,searchNode:searchNode,getChilds:getChilds,structure:function(){return _structure}}}(),Atoms.Ide.Atom.Canvas=function(_super){function Canvas(){this.resize=__bind(this.resize,this),this["default"]={events:["dragover","dragleave","drop","mouseover","mouseleave","click"]},Canvas.__super__.constructor.apply(this,arguments)}return __extends(Canvas,_super),Canvas.template='<div id="canvas" data-atoms="app"></div>',Canvas.DEVICES={iphone:{width:320,height:568,scale:1},ipad:{width:768,height:1024,scale:.75},laptop:{width:1280,height:800,scale:.75}},Canvas.prototype.current={device:"iphone",landscape:!1},Canvas.prototype.resize=function(device,landscape){return null==landscape&&(landscape=!1),device===this.current.device?this.current.landscape=!this.current.landscape:this.current={device:device,landscape:!1},device=this.constructor.DEVICES[this.current.device],this.current.landscape&&(device={width:device.height,height:device.width,scale:device.scale}),this.el.style("width",""+device.width+"px"),this.el.style("height",""+device.height+"px"),this.el.style("-webkit-transform","scale("+device.scale+")")},Canvas}(Atoms.Class.Atom),Atoms.Ide.Atom.Li=function(_super){function Li(){return _ref=Li.__super__.constructor.apply(this,arguments)}return __extends(Li,_super),Li.template='<li draggable="true">{{namespace}}</li>',Li}(Atoms.Class.Atom),Atoms.Ide.Atom.TreeLi=function(_super){function TreeLi(attributes){null==attributes&&(attributes={}),attributes.events=["dragstart","dragover","drop","dragend","click"],TreeLi.__super__.constructor.apply(this,arguments)}return __extends(TreeLi,_super),TreeLi.template='<div data-component-uid="{{uid}}" data-level="{{level}}" draggable="true" class="{{type}}">\n  <span class="icon arrow-down"></span>\n  <strong><span class="icon"></span> {{class_name}}</strong>\n  {{#if.id}}\n    <small>#{{id}}</small>\n  {{/if.id}}\n</div>',TreeLi.prototype.toggle=function(){var icon,method;return icon=this.el.find(".icon"),method=icon.hasClass("arrow-right")?"show":"hide",icon.toggleClass("arrow-right").toggleClass("arrow-down"),this.el.find("ul")[method]()},TreeLi}(Atoms.Class.Atom),Atoms.Ide.Molecule.List=function(_super){function List(attributes){var container,item,li,_i,_len,_ref1;for(this.attributes=attributes,this._onDragStart=__bind(this._onDragStart,this),List.__super__.constructor.apply(this,arguments),container=this.el.children("ul"),_ref1=this.attributes.items,_i=0,_len=_ref1.length;_len>_i;_i++)item=_ref1[_i],item.parent=this,item.parent.el=container,li=new Atoms.Ide.Atom.Li(item),li.el.bind("dragstart",this._onDragStart)}return __extends(List,_super),List.template='<div {{#if.style}}class="{{style}}"{{/if.style}}>\n  <span class="icon"></span>\n  <ul></ul>\n</div>',List.prototype._onDragStart=function(ev){var ns;return null==ev&&(ev=event),ns=ev.target.innerText,ev.dataTransfer.setData("AtomicNamespace",ns),this.bubble("dragStart",ns)},List}(Atoms.Class.Molecule),Atoms.Ide.Molecule.Tree=function(_super){function Tree(){return this._removeDropContainers=__bind(this._removeDropContainers,this),_ref1=Tree.__super__.constructor.apply(this,arguments)}return __extends(Tree,_super),Tree.template="<ul></ul>",Tree.dragging_element=null,Tree.create_drop_container=function(index){var container;return container=$$('<div class="treeDropContainer" data-drop-index="'+index+'"></div>'),container.bind("dragover",function(){return container.addClass("hover")}),container.bind("dragleave",function(){return container.removeClass("hover")}),container[0]},Tree.remove_drop_containers=function(){return Ide.Elements.tree.el.find(".treeDropContainer").remove()},Tree.prototype.onTreeLiClick=function(event,atom){var icon;return event.stopPropagation(),icon=$$(event.target).closest("span.icon"),icon.length?atom.toggle():Ide.Properties.load(Ide.Article.components[atom.attributes.uid]),!1},Tree.prototype.onTreeLiDragstart=function(event,atom){return this._appendDropContainers(),this.constructor.dragging_element=atom.attributes.uid,event.stopPropagation(),!1},Tree.prototype.onTreeLiDrop=function(ev,atom){var ch,children,comps,i,new_index,uid,_i,_len;for(comps=[],children=atom.el.children("ul").children(),console.log(children),i=_i=0,_len=children.length;_len>_i;i=++_i)ch=children[i],uid=ch.getAttribute("data-component-uid"),Ide.Article.components[uid].order=i,comps.push(Ide.Article.components[uid]);return console.log(comps),new_index=ev.target.getAttribute("data-drop-index"),Ide.Article.components[this.constructor.dragging_element].order=parseInt(new_index),this._orderComponents(),ev.preventDefault(),ev.stopPropagation(),!1},Tree.prototype.onTreeLiDragover=function(){return event.preventDefault(),event.stopPropagation(),!1},Tree.prototype.onTreeLiDragend=function(){return this.constructor.remove_drop_containers(),this.constructor.dragging_element=null,!1},Tree.prototype._orderComponents=function(){return console.log(this)},Tree.prototype._appendDropContainers=function(){var children,i,_results;for(children=this.el[0].childNodes,i=children.length-1,this.el[0].appendChild(this.constructor.create_drop_container(i)),_results=[];i>=0;)this.el[0].insertBefore(this.constructor.create_drop_container(i),children[i]),_results.push(i--);return _results},Tree.prototype._removeDropContainers=function(ev,context){return context=context||this,context.el.children("[data-drop-index]").remove(),!1},Tree}.call(this,Atoms.Class.Molecule),Atoms.Ide.Organism.Article=function(_super){function Article(attributes){null==attributes&&(attributes={}),Article.__super__.constructor.call(this,attributes),this.render(),this.pages=[],this.index=-1,this.components={},this.canvas=new Atoms.Ide.Atom.Canvas({parent:this})}return __extends(Article,_super),Article.template="<article></article>",Article.prototype.onButtonTap=function(event,button){return"save_all"===button.attributes.action?Atoms.Ide.Project.save():"add_page"===button.attributes.action?this.addPage():"delete_page"===button.attributes.action&&this.deletePage(),!1},Article.prototype.onPageButtonTap=function(ev,button){return this.showPage(button.attributes.index-1),!1},Article.prototype.onCanvasDrop=function(ev){var attributes,closest_parent,namespace,parent_uid,parents;return null==ev&&(ev=event),namespace=Ide.Elements.draggingNamespace,attributes=Ide.Elements.ns_attributes[namespace],parents=Ide.Elements.available_parents[namespace],closest_parent=this._getClosestComponent($$(ev.target),parents),closest_parent.length?(parent_uid=closest_parent.attr("data-component-uid"),attributes.parent=parent_uid?this.components[parent_uid]:this.canvas,this.appendComponent(namespace,attributes)):alert('Parent not found... \n"'+namespace+'" containers are: \n- '+parents.join("\n- ")),!1},Article.prototype.onCanvasDragover=function(ev){var closest,namespace,parents;return null==ev&&(ev=event),namespace=Ide.Elements.draggingNamespace,parents=Ide.Elements.available_parents[namespace],closest=this._getClosestComponent($$(ev.target),parents),closest.length&&closest.addClass("hover"),ev.preventDefault(),!1},Article.prototype.onCanvasDragleave=function(){return this._cleanClasses(),!1},Article.prototype.onCanvasMouseover=function(ev){var closest;return null==ev&&(ev=event),this._cleanClasses(),closest=$$(ev.target).closest("[data-component-uid]"),closest.addClass("hover"),ev.preventDefault(),ev.stopPropagation(),!1},Article.prototype.onCanvasMouseleave=function(ev){return null==ev&&(ev=event),this._cleanClasses(),!1},Article.prototype.onCanvasClick=function(ev){var closest_component,uid;return null==ev&&(ev=event),closest_component=$$(ev.target).closest("[data-component-uid]"),closest_component.length&&(uid=closest_component.attr("data-component-uid"),this.components[uid]&&Ide.Properties.load(this.components[uid])),!1},Article.prototype["delete"]=function(uid){var _this=this;return this.components[uid]?(this.components[uid].el.find("[data-component-uid]").each(function(i,el){return delete _this.components[el.getAttribute("data-component-uid")],el.remove()
}),this.components[uid].el.remove(),delete this.components[uid],Ide.Elements.updateTree()):void 0},Article.prototype.selectComponent=function(uid){var closest_root,root_node_selector;return root_node_selector="article,aside",this.el.find("[data-component-uid]").removeClass("marked"),this.components[uid].el.addClass("marked"),this.canvas.el.find(root_node_selector).removeClass("active"),closest_root=this.components[uid].el.closest(root_node_selector),closest_root.addClass("active")},Article.prototype.appendComponent=function(namespace,attributes,update_all){var component;return null==update_all&&(update_all=!0),component=this._renderComponent(namespace,attributes),update_all&&(this._cleanClasses(),Ide.Elements.updateTree(),Ide.Properties.load(component)),component},Article.prototype._renderComponent=function(namespace,attributes,component){var child,ns_parts,_i,_len,_ref2;if(null==component&&(component=null),component||(ns_parts=namespace.split("."),component=new Atoms[ns_parts[0]][ns_parts[1]](attributes),component.el||component.render()),component.el.attr("data-component-uid",component.uid),component.el.attr("data-component-namespace",this._getNS(component)),this.components[component.uid]=component,component.children)for(_ref2=component.children,_i=0,_len=_ref2.length;_len>_i;_i++)child=_ref2[_i],this._renderComponent(null,null,child);return component},Article.prototype._getClosestComponent=function(target,parents){var closest,parentNS,parents_selector;return parents?(parents_selector=function(){var _i,_len,_results;for(_results=[],_i=0,_len=parents.length;_len>_i;_i++)parentNS=parents[_i],_results.push('[data-component-namespace="'+parentNS+'"]');return _results}(),closest=target.closest(parents_selector.join(",")),closest.first()):this.canvas.el},Article.prototype._getNS=function(component){return""+component.constructor.type+"."+component.constructor.name},Article.prototype._cleanClasses=function(){return this.el.removeClass("hover").find(".hover").removeClass("hover")},Article}(Atoms.Class.Organism),Atoms.Ide.Organism.Elements=function(_super){function Elements(attributes){null==attributes&&(attributes={}),attributes.method="prepend",Elements.__super__.constructor.call(this,attributes),this.ns_attributes={},this.available_parents={},this.render(),this.load(),this.tree=new Atoms.Ide.Molecule.Tree({parent:this,container:this.el.children("section")}),this.appendChild("Molecule","Navigation",{container:this.el.children("header"),style:"right",children:[{"Atom.Button":{icon:"ios7-cloud-upload-outline",style:"accept",events:["tap"],callbacks:["onSave"]}}]})}var _getProperties,_valid;return __extends(Elements,_super),Elements.template='<aside>\n  <header></header>\n  <section class="active"></section>\n</aside>',Elements.prototype.onListDragStart=function(ns){return this.draggingNamespace=ns},Elements.prototype.onSave=function(){return Atoms.Ide.Project.save(),!1},Elements.prototype.load=function(){return this._list(this._namespace("Atom"),"atom"),this._list(this._namespace("Molecule"),"molecule"),this._list(this._namespace("Organism"),"organism"),this._list(this._namespace("Template"),"template")},Elements.prototype._list=function(items,style){return new Atoms.Ide.Molecule.List({parent:this,container:this.el.find("header"),items:items,style:style})},_valid=function(property){var valid,_ref2;return valid=!0,("/"===(_ref2=property[0])||"#"===_ref2||"^"===_ref2)&&(valid=!1),valid},_getProperties=function(atoms_entity){var prop,properties,regexp,result,tpl,_results;for(regexp=new RegExp("\\{\\{([^\\}]+)\\}\\}","m"),tpl=atoms_entity.template.toString(),properties={};result=regexp.exec(tpl);)_valid(result[1])&&(properties[result[1]]=!0),tpl=tpl.replace(regexp,"");_results=[];for(prop in properties)_results.push(prop);return _results},Elements.prototype.updateTree=function(){var component,struct,_i,_len,_results;for(this.tree.el.html(""),struct=Atoms.Ide.Project.getStructure(!0),_results=[],_i=0,_len=struct.length;_len>_i;_i++)component=struct[_i],_results.push(this.loadTree(component));return _results},Elements.prototype.loadTree=function(tree,parent,level){var atom,child,children_level,list,_i,_len,_ref2,_ref3,_results;if(null==parent&&(parent=null),null==level&&(level=0),parent=parent||this.tree,atom=this._paintTreeLevel(tree,parent,level),(null!=(_ref2=tree[atom.attributes.text].children)?_ref2.length:void 0)>0){for(list=new Atoms.Ide.Molecule.Tree({parent:atom}),children_level=level+1,_ref3=tree[atom.attributes.text].children,_results=[],_i=0,_len=_ref3.length;_len>_i;_i++)child=_ref3[_i],_results.push(this.loadTree(child,list,children_level));return _results}},Elements.prototype.selectTreeElement=function(uid){return this.tree.el.find("[data-component-uid]").removeClass("active"),this.tree.el.find("[data-component-uid='"+uid+"']").addClass("active")},Elements.prototype._paintTreeLevel=function(component,parent,level){var atom,base,data,key;for(key in component)data=component[key],base=key.split("."),atom=new Atoms.Ide.Atom.TreeLi({parent:parent,text:key,type:base[0].toLowerCase(),class_name:base[1],uid:data.uid,id:data.id,level:level});return atom},Elements.prototype._namespace=function(namespace){var available_ns,name,ns,results,_i,_len,_ref2;results=[];for(name in Atoms[namespace]){if(ns=""+namespace+"."+name,Atoms[namespace][name].available)for(_ref2=Atoms[namespace][name].available,_i=0,_len=_ref2.length;_len>_i;_i++)available_ns=_ref2[_i],this.available_parents[available_ns]=this.available_parents[available_ns]||[],this.available_parents[available_ns].push(ns);this.ns_attributes[ns]=_getProperties(Atoms[namespace][name]),results.push({namespace:""+namespace+"."+name,properties:_getProperties(Atoms[namespace][name])})}return results},Elements}(Atoms.Class.Organism),Atoms.Ide.Organism.Properties=function(_super){function Properties(attributes){null==attributes&&(attributes={}),Properties.__super__.constructor.call(this,attributes),this.render(),this.appendChild("Atom","Title",{id:"title",style:"title",container:this.el.find("header")}),this.appendChild("Molecule","Form",{id:"form",container:this.el.find("section"),events:["keyup","change"],callbacks:["onChange","onChange"]}),new Atoms.Atom.Button({parent:this,container:this.el.find("section"),icon:"close-circled",text:"Delete element",style:"fluid cancel",callbacks:["onDelete"]})}return __extends(Properties,_super),Properties.template='<aside>\n  <header></header>\n  <section></section>\n  <footer>\n    <nav data-container="buttons"></nav>\n  </footer>\n</aside>',Properties.prototype.component=null,Properties.prototype.load=function(component){return this.component=component,this.component?(this.namespace=""+this.component.constructor.type+"."+this.component.constructor.name,this._renderProperties(Ide.Elements.ns_attributes[this.namespace]),Ide.Article.selectComponent(this.component.uid),Ide.Elements.selectTreeElement(this.component.uid)):void 0},Properties.prototype.onChange=function(){return this.component.attributes=this.form.value(),this._doRefresh(this.component,!0),Ide.Article.selectComponent(this.component.uid),Ide.Elements.selectTreeElement(this.component.uid),!1},Properties.prototype.onDelete=function(){return Ide.Article["delete"](this.component.uid),this.load(null),!1},Properties.prototype._doRefresh=function(component,is_first){return null==is_first&&(is_first=!1),component.refresh(),component.el.attr("data-component-uid",component.uid),component.el.attr("data-component-namespace",""+component.constructor.type+"."+component.constructor.name),"Atom"!==component.constructor.type?(component.el.html(""),Atoms.Ide.Project.updateNode(component.uid),Ide.Elements.updateTree()):void 0},Properties.prototype._renderProperties=function(properties){var property,_i,_len,_results;for(this.form.children=[],this.form.el.html(""),this.title.el.text(this.namespace),this.el.attr("class",this.namespace.split(".")[0].toLowerCase()),_results=[],_i=0,_len=properties.length;_len>_i;_i++)property=properties[_i],_results.push(this._renderProperty(property));return _results},Properties.prototype._renderProperty=function(property){var attributes,namespace;return this.form.appendChild("Atom","Label",{text:property}),attributes={name:property,value:this.component.attributes[property]},"icon"===property?(namespace="Select",attributes.options=Atoms.Ide.Constants.ICONS,attributes.events=["change"]):(namespace="Input",attributes.events=["keyup"]),this.form.appendChild("Atom",namespace,attributes)},Properties}(Atoms.Class.Organism),Atoms.Ide.Organism.Header=function(_super){function Header(attributes){null==attributes&&(attributes={}),this.method="prepend",Header.__super__.constructor.call(this,attributes),this.render(),this.appendChild("Molecule","Navigation",{style:"center",children:[{"Atom.Button":{icon:"iphone",style:"active"}},{"Atom.Button":{icon:"ipad"}},{"Atom.Button":{icon:"laptop"}}]})}return __extends(Header,_super),Header.template='<header>\n  <h1 class="inline title">Name of project</h1>\n  <nav class="right inline">\n    <a href="#">saksk</a>\n    <figure></figure>\n  </nav>\n</header>',Header.prototype.onButtonTouch=function(){var atom,event,hierarchy;return event=arguments[0],atom=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],Ide.Article.canvas.resize(atom.attributes.icon),!1},Header}(Atoms.Class.Organism),this.Ide={Header:new Atoms.Ide.Organism.Header,Elements:new Atoms.Ide.Organism.Elements,Article:new Atoms.Ide.Organism.Article,Properties:new Atoms.Ide.Organism.Properties}}).call(this);